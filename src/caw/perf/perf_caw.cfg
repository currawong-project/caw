{
  base_dir:    "~/src/caw/src/caw/perf/io",
  io_dict:     "~/src/caw/src/caw/cfg/io.cfg"            // Runtime configuration file.
  proc_dict:   "~/src/caw/src/libcw/flow/proc_dict.cfg", // Processor class definition file.
  udp_dict:    "~/src/caw/src/libcw/flow/udp_dict.cfg",  // User defined proc files 
    
  programs: {


   ex_00_mod_sine: {

      dur_limit_secs:30.0,  // Run the network for 5 seconds
      non_real_time_fl: true,
      
      network: {

        procs: {
          lfo:   { class: sine_tone, args:{ hz:3, dc:440, gain:110 }}
          sh:    { class: sample_hold,            in:{ in:lfo.out } }
          osc:   { class: sine_tone, preset:mono, in:{ hz:sh.out } },
	  aout:  { class:audio_out, in:{ in:osc.out }, args:{ dev_label:"main"} }
	  //af:  { class: audio_file_out, in: { in:osc.out } args:{  fname:"$/out.wav"} }
        }
      }
    }

    ex_01_score_player: {

      network: {
      
        procs: {
	  player: { class:score_player, args:{ fname:"$/score_20240504.csv" }},
	  samp_vt:{ class: vel_table,  in:{ in:player.out }, args:{ vel_tbl_fname:"$/vel_table_perf.json", vel_tbl_label:"ivory" }},
	  
	  stop: { class: halt,     in:{ in:player.done_fl }}		       
          vctl: { class: poly_voice_ctl, in:{ in:samp_vt.out }, args:{ voice_cnt:20  } },

	  voice_poly: {
	    class: poly,
	    args: { count:20, parallel_fl:false }

	    network: {
	      procs: {
	        voc: { class:piano_voice, in:{ _.in:_.vctl.out_ },
		                          out:{ _.done_fl:_.vctl.done_fl_ },
					  args:{ wtb_fname:"~/media/audio/wt6/wt_bank.json", wtb_instr:"piano" } },
		//voc: { class:midi_voice, in:{_.in:_.vctl.out_ }, out:{ _.done_fl:_.vctl.done_fl_ }, args:{chCnt:2, gain:0.2 } },
	      }
	    }
	  }

	  amix: { class: audio_mix,   in:{ in_:voice_poly.voc_.out }     args:{ igain_:1.0 }},
	  aout: { class: audio_out,   in:{ in:amix.out }, args:{ dev_label:"main"}}
	  
        }
      }
    }


    ex_01a_score_player: {

      network: {
      
        procs: {
	  player: { class:score_player, args:{ fname:"$/score_20240504.csv" }},
	  samp_vt:{ class: vel_table,  in:{ in:player.out }, args:{ vel_tbl_fname:"$/vel_table_perf.json", vel_tbl_label:"ivory" }},
	  
	  stop: { class: halt,     in:{ in:player.done_fl }}		       
          vctl: { class: poly_voice_ctl, in:{ in:samp_vt.out }, args:{ voice_cnt:20  } },

	  voice_poly: {
	    class: poly,
	    args: { count:20, parallel_fl:false }

	    network: {
	      procs: {
		voc: { class:midi_voice, in:{_.in:_.vctl.out_ }, out:{ _.done_fl:_.vctl.done_fl_ }, args:{chCnt:2, gain:0.2 } },
	      }
	    }
	  }


	  xf_ctl: { class:poly_xform_ctl, in:{ in_:voice_poly.voc_.out,
	                                       midi_:vctl.out_,
					       donefl_:voice_poly.voc_.done_fl  }, args:{ out_ch_cnt:5 } }
					       
	  amix: { class: audio_mix,   in:{ in_:xf_ctl.out_ }     args:{ igain_:1.0 }},
	  //amix: { class: audio_mix,   in:{ in_:voice_poly.voc_.out }     args:{ igain_:1.0 }},

	  aout: { class: audio_out,   in:{ in:amix.out }, args:{ dev_label:"main"}}
	  
        }
      }
    }

    ex_02_score_player: {

      ui_create_fl: true,
      
      network: {
      
        procs: {
	  //xform_igain:  { class: number,   args:{ in:1.0f }},
	  player: { class:score_player, args:{ fname:"$/score_20240504.csv" }},

	  pian_vt:{ class: vel_table,                  in:{ in:player.out }, args:{ vel_tbl_fname:"$/vel_table_perf.json", vel_tbl_label:"spirio" }},
	  samp_vt:{ class: vel_table,                  in:{ in:player.out }, args:{ vel_tbl_fname:"$/vel_table_perf.json", vel_tbl_label:"ivory" }},


	  stop:   { class: halt,                       in:{ in:player.done_fl }}
	  
	  //mout:   { class: midi_out,                   in:{ rin:pian_vt.out }, args:{ print_fl:false, dev_label:"Fastlane", port_label:"Fastlane MIDI A" } } 
          vctl:   { class: poly_voice_ctl,             in:{ in:samp_vt.out },  args:{ voice_cnt:30  } },
	  ps:     { class: preset_select, preset:init, in:{ in:player.out },  args:{ fname:"$/m1_458_trans_5.txt" } }
	  
	  voice_poly: {
	    class: poly,
	    in:   { count:vctl.voice_cnt }
	    args: { parallel_fl:false }

	    network: {
	      procs: {
	        voc: { class:piano_voice, in:{ _.in:_.vctl.out_ },
		                          out:{ _.done_fl:_.vctl.done_fl_ },
					  args:{ wtb_fname:"~/media/audio/wt6/wt_bank.json", wtb_instr:"piano" } },
	      
	        //voc: { class:midi_voice, in:{ _.in:_.vctl.out_ }, out:{ _.done_fl:_.vctl.done_fl_ }, args:{print_fl:false, chCnt:2, gain:0.2 } },
	      }
	    }
	  }

	  xf_ctl: { class:poly_xform_ctl, in:{ in_:voice_poly.voc_.out,
	                                       midi_:vctl.out_,
					       donefl_:voice_poly.voc_.done_fl,
					       trig:ps.preset_label  }, args:{ out_ch_cnt:10 } } 

	  xf_poly : {
	    class: poly,
	    
	    in: { count:xf_ctl.out_ch_cnt,
	          preset_sfx_id:xf_ctl.out_ch_idx,
		  preset_label:ps.preset_label },
	    
	    args: { parallel_fl:true }
	    
	    network: {
	      procs: {
	        //igain: { class: audio_gain,       in:{ in:_.xf_ctl.out, gain:_.xform_igain.out }, },
	        pva:   { class: pv_analysis,      in:{ in:_.xf_ctl.out },  args:{ wndSmpN:512, hopSmpN:128, hzFl:false  } },	       
	        sd:    { class: spec_dist,        in:{ in:pva.out },  preset:kc, args:{ bypass:false }   },	       
                pvs:   { class: pv_synthesis,     in:{ in:sd.out  }              },
	        cmp:   { class: compressor,       in:{ in:pvs.out },  preset:kc, args:{ bypass:false }   },
		ogain: { class: audio_gain,       in:{ in:cmp.out } },
	      },
	      
	      presets: {
	        dry:   { pva:dry,   sd:dry,   cmp:dry,   ogain:{ gain:0.0 } },
	        a:     { pva:a,     sd:a,     cmp:a,     ogain:{ gain:1.0 } },
	        b:     { pva:b,     sd:b,     cmp:b,     ogain:{ gain:1.0 } },
	        c:     { pva:c,     sd:c,     cmp:c,     ogain:{ gain:1.0 } },
	        d:     { pva:d,     sd:d,     cmp:d,     ogain:{ gain:1.0 } },
	        f1:    { pva:f_1,   sd:f_1,   cmp:f_1,   ogain:{ gain:1.0 } },
	        f2:    { pva:f_2,   sd:f_2,   cmp:f_2,   ogain:{ gain:1.0 } },
	        f3:    { pva:f_3,   sd:f_3,   cmp:f_3,   ogain:{ gain:1.0 } },
	        f4:    { pva:f_4,   sd:f_4,   cmp:f_4,   ogain:{ gain:1.0 } },
	        g:     { pva:g,     sd:g,     cmp:g,     ogain:{ gain:1.0 } },
	        ga:    { pva:g_a    sd:g_a,   cmp:g_a,   ogain:{ gain:1.0 } },
	        g1a:   { pva:g_1_a  sd:g_1_a, cmp:g_1_a, ogain:{ gain:1.0 } },
	        g1d:   { pva:g_1_d  sd:g_1_d, cmp:g_1_d, ogain:{ gain:1.0 } }
	      }
	    }
	  }
	  
	  wet_poly_mix: { class: audio_mix,   in:{ in_:xf_poly.ogain_.out } args:{ igain_:1.0 }},
	  dry_poly_mix: { class: audio_mix,   in:{ in_:voice_poly.voc_.out} args:{ igain_:1.0 }},
	  
	  //amix: { class: audio_mix,   in:{ in_:xf_ctl.out_ } args:{ igain_:1.0 }},
	  //aout: { class: audio_out,   in:{ in:amix.out }, args:{ dev_label:"main"}}

	  // apply the wet/dry gain balance
	  wd_bal:       { class: balance, args{}},
	  wet_bal_gain: { class: audio_gain, in:{ in:wet_poly_mix.out, gain:wd_bal.out }     },
	  dry_bal_gain: { class: audio_gain, in:{ in:dry_poly_mix.out, gain:wd_bal.inv_out } },

	  mstr_wet_out: { class: audio_gain, in:{ in:wet_bal_gain.out }, args:{ gain:0.5 } }
	  mstr_dry_out: { class: audio_gain, in:{ in:dry_bal_gain.out }, args:{ gain:0.5 } },


	  // merge the wet/dry signals into a single 4 channel signal
	  merge: { class: audio_merge,   in:{ in0:mstr_wet_out.out, in1:mstr_dry_out.out }  },

	  // delay the incoming signal to sync it with the piano
	  sync_delay { class: audio_delay, in: { in:merge.out }, args:{ delayMs:400 }}

          aout:  { class: audio_out,     in:{ in:sync_delay.out }, args:{ dev_label:"main" } },

	  //sel_two: { class: audio_split, in:{ in:sync_delay.out } args:{ select[0,0,1,1]} } 
	  //aout:  { class: audio_out,     in:{ in:sel_two.out0 }, args:{ dev_label:"main" } },

	  
        }
      }
    }


   ex_03_preset_test: {

      network: {

        procs: {
          lfo:   { class: sine_tone, args:{ hz:3, dc:440, gain:110 }}
          sh:    { class: sample_hold,            in:{ in:lfo.out } }
          osc:   { class: sine_tone,              in:{ hz:sh.out }, args:{ ch_cnt:2 } },
	  gain:  { class: audio_gain, in:{ in:osc.out }, args:{ gain:0.3 } }
	  aout:  { class: audio_out, in:{ in:gain.out }, args:{ dev_label:"main"} }
        }
	
	presets:
	{
	  a: { gain:{ gain:0.2 } },
	  b: { gain:{ gain:[0.1,0.3] } }
	}

      }
    }
  
    ex_04_score_player: {
    
      ui_create_fl: true,
      
      dur_limit_secs:10.0,  // Run the network for 5 seconds
      non_real_time_fl: true,

      network: {
      
        procs: {
	  player: { class:score_player, args:{ fname:"$/score_20240504.csv" }},

	  pian_vt:{ class: vel_table,                  in:{ in:player.out }, args:{ vel_tbl_fname:"$/vel_table_perf.json", vel_tbl_label:"spirio" }},
	  samp_vt:{ class: vel_table,                  in:{ in:player.out }, args:{ vel_tbl_fname:"$/vel_table_perf.json", vel_tbl_label:"ivory" }},
	  
	  stop:   { class: halt,                       in:{ in:player.done_fl }}

          vctl:   { class: poly_voice_ctl,             in:{ in:samp_vt.out },  args:{ voice_cnt:25  } },
	  ps:     { class: preset_select, preset:init, in:{ in:player.out },  args:{ fname:"$/m1_458_trans_5.txt" } }
	  
	  voice_poly: {
	    class: poly,
	    in:   {
	            count:vctl.voice_cnt,
		  }
		  
	    args: { parallel_fl:false }

	    network: {
	      procs: {
	        voc: { class:piano_voice, in:{ _.in:_.vctl.out_ },
		                          out:{ _.done_fl:_.vctl.done_fl_ },
					  args:{ wtb_fname:"~/media/audio/wt6/wt_bank.json", wtb_instr:"piano" } },
					  
	        pva:   { class: pv_analysis,      in:{ in:voc.out },  args:{ wndSmpN:512, hopSmpN:128, hzFl:false  } },	       
	        sd:    { class: spec_dist,        in:{ in:pva.out },  preset:kc, args:{ bypass:false }   },	       
                pvs:   { class: pv_synthesis,     in:{ in:sd.out  }              },
	        cmp:   { class: compressor,       in:{ in:pvs.out },  preset:kc, args:{ bypass:false }   },
		ogain: { class: audio_gain,       in:{ in:cmp.out } },
	      }

	      presets: {
	        dry:   { pva:dry,   sd:dry,   cmp:dry,   ogain:{ gain:0.0 } },
	        a:     { pva:a,     sd:a,     cmp:a,     ogain:{ gain:1.0 } },
	        b:     { pva:b,     sd:b,     cmp:b,     ogain:{ gain:1.0 } },
	        c:     { pva:c,     sd:c,     cmp:c,     ogain:{ gain:1.0 } },
	        d:     { pva:d,     sd:d,     cmp:d,     ogain:{ gain:1.0 } },
	        f1:    { pva:f_1,   sd:f_1,   cmp:f_1,   ogain:{ gain:1.0 } },
	        f2:    { pva:f_2,   sd:f_2,   cmp:f_2,   ogain:{ gain:1.0 } },
	        f3:    { pva:f_3,   sd:f_3,   cmp:f_3,   ogain:{ gain:1.0 } },
	        f4:    { pva:f_4,   sd:f_4,   cmp:f_4,   ogain:{ gain:1.0 } },
	        g:     { pva:g,     sd:g,     cmp:g,     ogain:{ gain:1.0 } },
	        ga:    { pva:g_a    sd:g_a,   cmp:g_a,   ogain:{ gain:1.0 } },
	        g1a:   { pva:g_1_a  sd:g_1_a, cmp:g_1_a, ogain:{ gain:1.0 } },
	        g1d:   { pva:g_1_d  sd:g_1_d, cmp:g_1_d, ogain:{ gain:1.0 } }
	      }

	    }
	  }

	  wet_poly_mix: { class: audio_mix,   in:{ in_:voice_poly.ogain_.out } args:{ igain_:1.0 }},
	  dry_poly_mix: { class: audio_mix,   in:{ in_:voice_poly.voc_.out}    args:{ igain_:1.0 }},
	  
	  // apply the wet/dry gain balance
	  wd_bal:       { class: balance, args{}},
	  wet_bal_gain: { class: audio_gain, in:{ in:wet_poly_mix.out, gain:wd_bal.out }     },
	  dry_bal_gain: { class: audio_gain, in:{ in:dry_poly_mix.out, gain:wd_bal.inv_out } },

	  mstr_wet_out: { class: audio_gain, in:{ in:wet_bal_gain.out }, args:{ gain:0.5 } }
	  mstr_dry_out: { class: audio_gain, in:{ in:dry_bal_gain.out }, args:{ gain:0.5 } },


	  // merge the wet/dry signals into a single 4 channel signal
	  merge: { class: audio_merge,   in:{ in0:mstr_wet_out.out, in1:mstr_dry_out.out }  },

	  // delay the incoming signal to sync it with the piano
	  sync_delay { class: audio_delay, in: { in:merge.out }, args:{ delayMs:400 }}

          //aout:  { class: audio_out,     in:{ in:sync_delay.out }, args:{ dev_label:"main" } },

	  sel_two: { class: audio_split, in:{ in:sync_delay.out } args:{ select[0,0,1,1]} } 
	  //aout:  { class: audio_out,     in:{ in:sel_two.out0 }, args:{ dev_label:"main" } },
	  af:  { class: audio_file_out, in: { in:sel_two.out0 }, args:{  fname:"$/out.wav"} }
	  
        }
      }
    }

    ex_05_score_player: {
    
      ui_create_fl: false,
      //dur_limit_secs:60.0,
      //non_real_time_fl: true,
      
      network: {
      
        procs: {
	  player: { class:score_player, args:{ fname:"$/score_20240504.csv",b_meas:0, e_meas:500, start:true }, ui: { create_fl:true } },

	  pian_vt:{ class: vel_table,                  in:{ in:player.out }, args:{ vel_tbl_fname:"$/vel_table_perf.json", vel_tbl_label:"spirio_1" }},
	  samp_vt:{ class: vel_table,                  in:{ in:player.out }, args:{ vel_tbl_fname:"$/vel_table_perf.json", vel_tbl_label:"ivory" }},
	  
	  //stop:   { class: halt,                       in:{ in:player.done_fl }}

	  //mout:   { class: midi_out,                   in:{ rin:pian_vt.out }, args:{ print_fl:false, dev_label:"Fastlane", port_label:"Fastlane MIDI A" } ui: { create_fl:true }} 
	  mout:   { class: midi_out,                   in:{ rin:pian_vt.out }, args:{ print_fl:false, dev_label:"iRig MIDI 2", port_label:"iRig MIDI 2 MIDI 1" } ui: { create_fl:true }} 

          vctl:   { class: poly_voice_ctl,             in:{ in:samp_vt.out },  args:{ voice_cnt:50  } },
	  ps:     { class: gutim_ps, preset:init,      in:{ in:player.out, midi_in_:vctl.out_, reset:player.start, loc_cnt:player.loc_cnt   },
	                                               preset: "init",
	                                               args:{ fname:"$/m1_458_trans_5.txt" },
						       ui:  { create_fl:true } }
						       
	  xform_igain:  { class: number,   args:{ in:1.0f }, ui: { create_fl:true } },

	  voice_poly: {
	    class: poly,
	    in:   {
	            count:vctl.voice_cnt,
		  }
		  
	    args: { parallel_fl:true }

	    network: {
	      procs: {
	        voc: { class:piano_voice, in:{ _.in:_.vctl.out_ },
		                          out:{ _.done_fl:_.vctl.done_fl_ },
					  args:{ wtb_fname:"~/media/audio/wt6/wt_bank.json",
					         wtb_instr:"piano",
						 rls_coeff: 0.95 } },
		g:     { class: audio_gain,       in:{ in:voc.out, gain:_.xform_igain.out }  },
	        pva:   { class: pv_analysis,      in:{ in:g.out, enable:voc.gate_fl, _.wndSmpN:_.ps.wnd_smp_cnt_ },  args:{ wndSmpN:512, hopSmpN:128, hzFl:false  } },
	        sd:    { class: spec_dist,        in:{ in:pva.out,
		                                       enable:voc.gate_fl,
		                                       _.ceiling:_.ps.ceiling_,
						       _.expo:_.ps.expo_,
						       _.thresh:_.ps.thresh_,
						       _.upr:_.ps.upr_,
						       _.lwr:_.ps.lwr_,
						       _.mix:_.ps.mix_ },  preset:kc, args:{ bypass:false }   },
		
                pvs:   { class: pv_synthesis,     in:{ in:sd.out, enable:voc.gate_fl  } },
	        cmp:   { class: compressor,       in:{ in:pvs.out,
		                                       enable:voc.gate_fl,
		                                       _.igain:_.ps.c_igain_,
						       _.ogain:_.ps.c_ogain_ }, preset:kc, args:{ bypass:false }   },
						       
		ogain: { class: audio_gain,       in:{ in:cmp.out, _.gain:_.ps.dry_gain_ } },
	      }

	    }
	  }

	  wet_poly_mix: { class: audio_mix,   in:{ in_:voice_poly.ogain_.out } args:{ igain_:1.0 }},
	  dry_poly_mix: { class: audio_mix,   in:{ in_:voice_poly.voc_.out}    args:{ igain_:1.0 }},
	  
	  // apply the wet/dry gain balance
	  wd_bal:       { class: balance, args{}},
	  wet_bal_gain: { class: audio_gain, in:{ in:wet_poly_mix.out, gain:wd_bal.out }     },
	  dry_bal_gain: { class: audio_gain, in:{ in:dry_poly_mix.out, gain:wd_bal.inv_out } },

	  mstr_wet_out: { class: audio_gain, in:{ in:wet_bal_gain.out }, args:{ gain:0.5 } }
	  mstr_dry_out: { class: audio_gain, in:{ in:dry_bal_gain.out }, args:{ gain:0.5 } },


	  // merge the wet/dry signals into a single 4 channel signal
	  merge: { class: audio_merge,   in:{ in0:mstr_wet_out.out, in1:mstr_dry_out.out }  },

	  // delay the incoming signal to sync it with the piano
	  sync_delay { class: audio_delay, in: { in:merge.out }, args:{ delayMs:400 }}

          //aout:  { class: audio_out,     in:{ in:sync_delay.out }, args:{ dev_label:"main" } },

	  sel_two: { class: audio_split, in:{ in:sync_delay.out } args:{ select[0,0,1,1]} } 
	  aout:  { class: audio_out,     in:{ in:sel_two.out0 }, args:{ dev_label:"main" } },
	  
	  //af:  { class: audio_file_out, in: { in:sync_delay.out }, args:{  fname:"$/out.wav"} }

	  //aout:  { class: audio_out,     in:{ in:dry_poly_mix.out }, args:{ dev_label:"main" } },
	  
        }
      }
    }

    ex_06_live_sampler: {
    
      
      network: {
      
        procs: {
	  m_in:   { class:midi_in },
	  
	  vctl:   { class: poly_voice_ctl,  in:{ in:m_in.r_out },  args:{ voice_cnt:25  } },
	  voice_poly: {
	    class: poly,
	    in:   {
	            count:vctl.voice_cnt,
		  }
		  
	    args: { parallel_fl:true }

	    network: {
	      procs: {
	        voc: { class:piano_voice, in:{ _.in:_.vctl.out_ },
		                          out:{ _.done_fl:_.vctl.done_fl_ },
					  args:{ wtb_fname:"~/media/audio/wt6/wt_bank.json",
					         wtb_instr:"piano",
						 rls_coeff: 0.95 } },
	      }
	    }
	  }
	   
	  voice_mix: { class: audio_mix, in:{ in_:voice_poly.voc_.out } args:{ igain_:1.0 }},

          aout:      { class: audio_out, in:{ in:voice_mix.out },       args:{ dev_label:"main" } },


        }
      }
   }

    ex_06_live_sampler_fx: {
         
      network: {
      
        procs: {
	  m_in:   { class:midi_in },
	  
	  vctl:   { class: poly_voice_ctl,  in:{ in:m_in.r_out },  args:{ voice_cnt:25  } },
	  ps:     { class: gutim_ps, preset:init,      in:{ in:m_in.r_out, midi_in_:vctl.out_   },
	                                               preset: "init",
	                                               args:{ fname:"$/m1_458_trans_5.txt" },
						       ui:  { create_fl:true } }
	  

	  xform_igain:  { class: number,   args:{ in:1.0f }, ui: { create_fl:true } },

	  voice_poly: {
	    class: poly,
	    in:   {
	            count:vctl.voice_cnt,
		  }
		  
	    args: { parallel_fl:true }

	    network: {
	      procs: {

	        voc: { class:piano_voice, in:{ _.in:_.vctl.out_ },
		                          // out:{ _.done_fl:_.vctl.done_fl_ },
					  args:{ wtb_fname:"~/media/audio/wt6/wt_bank.json",
					         wtb_instr:"piano",
						 rls_coeff: 0.95 } },

		g:     { class: audio_gain,       in:{ in:voc.out, gain:_.xform_igain.out }  },
	        pva:   { class: pv_analysis,      in:{ in:g.out, _.enable:_.vctl.gate_fl_, _.wndSmpN:_.ps.wnd_smp_cnt_ },  args:{ wndSmpN:512, hopSmpN:128, hzFl:false  } },
	        sd:    { class: spec_dist,        in:{ in:pva.out,
		                                       _.enable:_.vctl.gate_fl_,
		                                       _.ceiling:_.ps.ceiling_,
						       _.expo:_.ps.expo_,
						       _.thresh:_.ps.thresh_,
						       _.upr:_.ps.upr_,
						       _.lwr:_.ps.lwr_,
						       _.mix:_.ps.mix_ },  preset:kc, args:{ bypass:false }   },
		
                pvs:   { class: pv_synthesis,     in:{ in:sd.out, _.enable:_.vctl.gate_fl_  } },
	        cmp:   { class: compressor,       in:{ in:pvs.out,
		                                       _.enable:_.vctl.gate_fl_,
		                                       _.igain:_.ps.c_igain_,
						       _.ogain:_.ps.c_ogain_ }, preset:kc, args:{ bypass:false }   },
						       
		ogain: { class: audio_gain,       in:{ in:cmp.out, _.gain:_.ps.dry_gain_ } },

		vdet:  { class: voice_detector,   in:{ in:ogain.out, _.enable_fl:_.vctl.gate_fl_ } out:{ _.done_fl:_.vctl.done_fl_ },  args:{ rls_thresh:0.01 } }

	      }
	    }
	  }
	   
	  voice_mix: { class: audio_mix, in:{ in_:voice_poly.ogain_.out } args:{ igain_:1.0 }},

          aout:      { class: audio_out, in:{ in:voice_mix.out },       args:{ dev_label:"main" } },


        }
      }
   }

   ex_07_score_follow : {

      //non_real_time_fl:true,
      //dur_limit_secs:20.0,

     network: {
       procs: {
         mf: { class:midi_file, args:{ alt_csv_fname:"$/taka_1_5_midi.csv" }, ui: { create_fl:true } },
	 sf: { class:score_follower_2, in:{ in:mf.r_out, reset_trigger:mf.start }, args:{ b_loc:4232, e_loc:4707, score_fname:"$/score_20240504.csv"}, ui: { create_fl:true } }
	 samp_vt:{ class: vel_table, in:{ in:sf.out }, args:{ vel_tbl_fname:"$/vel_table_perf.json", vel_tbl_label:"ivory" }},

       }
     }
   }

   ex_08_score_follow : {

      //non_real_time_fl:true,
      //dur_limit_secs:10.0,
      //profile_fl:true,

     network: {
       procs: {
         /*
         flist: { class:string_list, ui:{ create_fl:true }, args:{
	     list:[ "/home/kevin/src/currawong/audio/shiau_uen/record_3/fix_midi.csv",
	            "/home/kevin/src/currawong/audio/shiau_uen/record_4/fix_midi.csv",
	            "/home/kevin/src/currawong/audio/shiau_uen/record_5/fix_midi.csv",
	            "/home/kevin/src/currawong/audio/shiau_uen/record_6/fix_midi.csv",
	            "/home/kevin/src/currawong/audio/shiau_uen/record_7/fix_midi.csv",
	            "/home/kevin/src/currawong/audio/shiau_uen/record_11/fix_midi.csv",
	            "/home/kevin/src/currawong/audio/shiau_uen/record_12/fix_midi.csv",
	            "/home/kevin/src/currawong/audio/shiau_uen/record_13/fix_midi.csv",
	            "/home/kevin/src/currawong/audio/shiau_uen/record_15/fix_midi.csv",
	            "/home/kevin/src/currawong/audio/shiau_uen/record_16/fix_midi.csv",
	            "/home/kevin/src/currawong/audio/shiau_uen/record_17/fix_midi.csv",
	            "/home/kevin/src/currawong/audio/shiau_uen/record_18/fix_midi.csv",
	            "/home/kevin/src/currawong/audio/shiau_uen/record_20/fix_midi.csv",
	            "/home/kevin/src/currawong/audio/shiau_uen/record_21/fix_midi.csv",
	            "/home/kevin/src/currawong/audio/shiau_uen/record_22/fix_midi.csv",
	            "/home/kevin/src/currawong/audio/shiau_uen/record_23/fix_midi.csv"]
	   }
	 }
         mf: { class:midi_file, in:{ alt_csv_fname:flist.out},  ui: { create_fl:true } },
	 sf: { class:score_follower_2, in:{ in:mf.r_out, reset_trigger:mf.start }, args:{ b_loc:481, e_loc:540, score_fname:"$/score_20240504.csv"}, ui: { create_fl:true } }
	*/
	/*
         flist: { class:string_list, ui:{ create_fl:true }, args:{
	     list:[ "/home/kevin/temp/arseniy_1/record_0/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_1/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_2/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_3/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_4/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_5/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_6/midi_am_sf.csv"]
	   }
	 }
         mf: { class:midi_file, in:{ alt_csv_fname:flist.out},  ui: { create_fl:true } },
	 sf: { class:score_follower_2, in:{ in:mf.r_out, reset_trigger:mf.start }, args:{ b_loc:481, e_loc:540, score_fname:"$/score_20240504.csv"}, ui: { create_fl:true } }
	 */
	 /*
         flist: { class:string_list, ui:{ create_fl:true }, args:{
	     list:[ "/home/kevin/temp/arseniy_1/record_7/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_8/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_9/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_10/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_11/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_12/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_13/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_14/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_15/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_16/midi_am_sf.csv"]
	   }
	 }
         mf: { class:midi_file, in:{ alt_csv_fname:flist.out},  ui: { create_fl:true } },
	 sf: { class:score_follower_2, in:{ in:mf.r_out, reset_trigger:mf.start }, args:{ b_loc:776, e_loc:807, score_fname:"$/score_20240504.csv"}, ui: { create_fl:true } }
	 */
	 /*
         flist: { class:string_list, ui:{ create_fl:true }, args:{
	     list:[ "/home/kevin/temp/arseniy_1/record_17/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_18/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_19/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_20/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_21/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_22/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_23/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_24/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_25/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_26/midi_am_sf.csv"]
	   }
	 }
         mf: { class:midi_file, in:{ alt_csv_fname:flist.out},  ui: { create_fl:true } },
	 sf: { class:score_follower_2, in:{ in:mf.r_out, reset_trigger:mf.start }, args:{ b_loc:2455, e_loc:2608, score_fname:"$/score_20240504.csv"}, ui: { create_fl:true } }
	 */
	/*
         flist: { class:string_list, ui:{ create_fl:true }, args:{
	     list:[ "/home/kevin/temp/arseniy_1/record_27/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_28/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_29/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_30/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_31/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_32/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_33/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_34/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_35/midi_am_sf.csv"]
	   }
	 }
         mf: { class:midi_file, in:{ alt_csv_fname:flist.out},  ui: { create_fl:true } },
	 sf: { class:score_follower_2, in:{ in:mf.r_out, reset_trigger:mf.start }, args:{ b_loc:3967, e_loc:4124, score_fname:"$/score_20240504.csv"}, ui: { create_fl:true } }
	 */
	/*
         flist: { class:string_list, ui:{ create_fl:true }, args:{
	     list:[ "/home/kevin/temp/arseniy_1/record_36/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_37/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_38/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_39/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_40/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_41/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_42/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_43/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_44/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_45/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_46/midi_am_sf.csv"]
	   }
	 }
         mf: { class:midi_file, in:{ alt_csv_fname:flist.out},  ui: { create_fl:true } },
	 sf: { class:score_follower_2, in:{ in:mf.r_out, reset_trigger:mf.start }, args:{ b_loc:6106, e_loc:6167, score_fname:"$/score_20240504.csv"}, ui: { create_fl:true } }
	 */
	 /*
         flist: { class:string_list, ui:{ create_fl:true }, args:{
	     list:[ "/home/kevin/temp/arseniy_1/record_47/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_48/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_49/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_50/midi_am_sf.csv",
	            "/home/kevin/temp/arseniy_1/record_51/midi_am_sf.csv",
		    "/home/kevin/temp/arseniy_1/record_52/midi_am_sf.csv"]
	   }
	 }
         mf: { class:midi_file, in:{ alt_csv_fname:flist.out},  ui: { create_fl:true } },
	 sf: { class:score_follower_2, in:{ in:mf.r_out, reset_trigger:mf.start }, args:{ b_loc:7702, e_loc:7825, score_fname:"$/score_20240504.csv"}, ui: { create_fl:true } }
	 */

         //mf: { class:midi_file, args:{ start:true, alt_csv_fname:"/home/kevin/temp/arseniy_1/record_25/midi_am_sf.csv"},  ui: { create_fl:true } },
	 //sf: { class:score_follower_2, in:{ in:mf.r_out, reset_trigger:mf.start }, args:{ b_loc:2455, e_loc:2608, score_fname:"$/score_20240504.csv"}, ui: { create_fl:true } }

	 /*
	 take_list: { class:gutim_take_menu, ui:{ create_fl:true }, args:{ cfg_fname:"$/gutim_take_menu.cfg" } },
         mf: { class:midi_file, in:{ alt_csv_fname:take_list.fname},  ui: { create_fl:true } },
	 sf: { class:score_follower_2, in:{ in:mf.r_out, reset_trigger:mf.start, b_loc:take_list.beg_loc, e_loc:take_list.end_loc }, args:{ score_fname:"$/score_20240504.csv"}, ui: { create_fl:true } }
	 */


	 samp_vt:{ class: vel_table, in:{ in:sf.out }, args:{ vel_tbl_fname:"$/vel_table_perf.json", vel_tbl_label:"ivory" }},
	 pian_vt:{ class: vel_table, in:{ in:sf.out }, args:{ vel_tbl_fname:"$/vel_table_perf.json", vel_tbl_label:"spirio_1" }},

	 mout:   { class: midi_out,  in:{ rin:mf.r_out }, args:{ print_fl:false, dev_label:"iRig MIDI 2", port_label:"iRig MIDI 2 MIDI 1" } ui: { create_fl:true }} 
	 //mout:   { class: midi_out,  in:{ rin:pian_vt.out }, args:{ print_fl:false, dev_label:"Fastlane", port_label:"Fastlane MIDI A" } } 

          vctl:   { class: poly_voice_ctl,             in:{ in:samp_vt.out , reset:mf.start},  args:{ voice_cnt:30 } },

	  ps:     { class: gutim_ps, preset:init,      in:{ in:sf.out,
	                                                     midi_in_:vctl.out_,
							     reset:mf.start,
							     loc_cnt:sf.loc_cnt },
	                                               preset: "init",
	                                               args:{ fname:"$/m1_458_trans_5.txt" },
						       ui:  { create_fl:true } }
						       
	  xform_igain:  { class: number,   args:{ in:1.0f }, ui: { create_fl:true } },

	  voice_poly: {
	    class: poly,
	    in:   { count:vctl.voice_cnt },		  
	    args: { parallel_fl:false, thread_cnt:8, cpu_affinityL:[2,3,4,6,8,9,10,11] },

	    network: {
	      procs: {
	        voc: { class:piano_voice, in:{ _.in:_.vctl.out_ },
		                          out:{ _.done_fl:_.vctl.done_fl_ },
					  args:{ wtb_fname:"~/media/audio/wt6/wt_bank.json",
					         wtb_instr:"piano",
						 rls_coeff: 0.99 } },
						 
		g:     { class: audio_gain,       in:{ in:voc.out, gain:_.xform_igain.out }  },
	        pva:   { class: pv_analysis,      in:{ in:g.out, enable:voc.gate_fl, _.wndSmpN:_.ps.wnd_smp_cnt_ },  args:{ wndSmpN:512, hopSmpN:128, hzFl:false  } },
	        sd:    { class: spec_dist,        in:{ in:pva.out,
		                                       enable:voc.gate_fl,
		                                       _.ceiling:_.ps.ceiling_,
						       _.expo:_.ps.expo_,
						       _.thresh:_.ps.thresh_,
						       _.upr:_.ps.upr_,
						       _.lwr:_.ps.lwr_,
						       _.mix:_.ps.mix_ },  preset:kc, args:{ bypass:false }   },
		
                pvs:   { class: pv_synthesis,     in:{ in:sd.out, enable:voc.gate_fl  } },
	        cmp:   { class: compressor,       in:{ in:pvs.out,
		                                       enable:voc.gate_fl,
		                                       _.igain:_.ps.c_igain_,
						       _.ogain:_.ps.c_ogain_ }, preset:kc, args:{ bypass:false }   },
						       
		ogain: { class: audio_gain,       in:{ in:cmp.out, _.gain:_.ps.dry_gain_ } },
	      }

	    }
	  }


	  //am: { class: audio_merge, in: { in_:voice_poly.voc_.out} }
	  //am: { class: audio_merge, in: { in_:voice_poly.ogain_.out} }
	  //af:  { class: audio_file_out, in: { in:am.out }, args:{  fname:"$/out_fx.wav"} }
	 
	  wet_poly_mix: { class: audio_mix,   in:{ in_:voice_poly.ogain_.out } args:{ igain_:1.0 }},
	  dry_poly_mix: { class: audio_mix,   in:{ in_:voice_poly.voc_.out}    args:{ igain_:1.0 }},


	  // apply the wet/dry gain balance
	  wd_bal:       { class: balance, args{}},
	  wet_bal_gain: { class: audio_gain, in:{ in:wet_poly_mix.out, gain:wd_bal.out }     },
	  dry_bal_gain: { class: audio_gain, in:{ in:dry_poly_mix.out, gain:wd_bal.inv_out } },

	  mstr_wet_out: { class: audio_gain, in:{ in:wet_bal_gain.out }, args:{ gain:0.5 } }
	  mstr_dry_out: { class: audio_gain, in:{ in:dry_bal_gain.out }, args:{ gain:0.5 } },
	   

	  // merge the wet/dry signals into a single 4 channel signal
	  merge: { class: audio_merge,   in:{ in0:mstr_wet_out.out, in1:mstr_dry_out.out }  },

	  // delay the incoming signal to sync it with the piano
	  sync_delay { class: audio_delay, in: { in:merge.out }, args:{ delayMs:400 }}

          aout:  { class: audio_out,     in:{ in:sync_delay.out }, args:{ dev_label:"main" } },

	  //sel_two: { class: audio_split, in:{ in:sync_delay.out } args:{ select[0,0,1,1]} }
	  //aout:  { class: audio_out,     in:{ in:sel_two.out0 }, args:{ dev_label:"main" } },

	  //wd_mix: { class:audio_mix, in:{ in0:mstr_wet_out.out, in1:mstr_dry_out.out } args:{igain_:0.8}}

	  //aout:  { class: audio_out,     in:{ in:wd_mix.out }, args:{ dev_label:"main" } },
	  
	  //af:  { class: audio_file_out, in: { in:wd_mix.out }, args:{  fname:"$/out.wav"} }

	  //aout:  { class: audio_out,     in:{ in:dry_poly_mix.out }, args:{ dev_label:"main" } },


	  
       }
     }
   }

   ex_09_string_list : {

     network: {
       procs: {
         slst: { class:string_list, ui:{ create_fl:true }, args:{
	     list:[ "/home/kevin/src/currawong/audio/workshop/beck1/record_0/midi.csv",
	            "/home/kevin/src/currawong/audio/workshop/beck1/record_1/midi.csv",
		    "/home/kevin/src/currawong/audio/workshop/beck1/record_2/midi.csv"]
	   }
	 }
	 
	 print: { class: print,    in: { in:slst.out, eol_fl:slst.out }, args:{ text:["string","output"] }}
       }
     }
   }


   ex_10_sampler_playback : {

      non_real_time_fl:true,
      dur_limit_secs:60.0,
      profile_fl:true,

     network: {
       procs: {

	 
          mf: { class:midi_file, args:{ start:true, alt_csv_fname:"/home/kevin/src/currawong/audio/workshop/beck1/record_2/fix_midi.csv"},  ui: { create_fl:true } },
	  //mf: { class:midi_file, args:{ start:true, alt_csv_fname:"$/test_0.csv"},  ui: { create_fl:true } },
          vctl:   { class: poly_voice_ctl, in:{ in:mf.r_out },  args:{ voice_cnt:50  } },
						       
	  voice_poly: {
	    class: poly,
	    in:   {
	            count:vctl.voice_cnt,
		  }
		  
	    args: { parallel_fl:true }

	    network: {
	      procs: {
	        voc: { class:piano_voice, in:{ _.in:_.vctl.out_ },
		                          out:{ _.done_fl:_.vctl.done_fl_ },
					  args:{ wtb_fname:"~/media/audio/wt6/wt_bank.json",
					         wtb_instr:"piano",
						 rls_coeff: 0.99,
						 rls_thresh: 0.01} },
	      }

	    }
	  }

	  dry_poly_mix: { class: audio_mix,   in:{ in_:voice_poly.voc_.out}    args:{ igain_:1.0 }},
	  af:  { class: audio_file_out, in: { in:dry_poly_mix.out }, args:{  fname:"$/out.wav"} }

	  //am: { class: audio_merge, in: { in_:voice_poly.voc_.out} }
	  //af:  { class: audio_file_out, in: { in:am.out }, args:{  fname:"$/out.wav"} }
	  

	  //aout:  { class: audio_out,     in:{ in:dry_poly_mix.out }, args:{ dev_label:"main" } },

       }
     }
   }

   ex_11_score_follow_rt : {

      //non_real_time_fl:true,
      //dur_limit_secs:10.0,

     network: {
       procs: {

 	 min: { class:midi_in }
	 

	 sf: { class:score_follower_2, in:{ in:min.r_out }, args:{ b_loc:7702, e_loc:7825, score_fname:"$/score_20240504.csv"}, ui: { create_fl:true } }
	 samp_vt:{ class: vel_table,   in:{ in:sf.out },    args:{ vel_tbl_fname:"$/vel_table_perf.json", vel_tbl_label:"ivory" }},
	 
	 //pian_vt:{ class: vel_table, in:{ in:sf.out }, args:{ vel_tbl_fname:"$/vel_table_perf.json", vel_tbl_label:"spirio_1" }},
	 //mout:   { class: midi_out,                   in:{ rin:pian_vt.out }, args:{ print_fl:false, dev_label:"iRig MIDI 2", port_label:"iRig MIDI 2 MIDI 1" } ui: { create_fl:true }} 

          vctl:   { class: poly_voice_ctl,             in:{ in:samp_vt.out, reset:sf.reset_trigger },  args:{ voice_cnt:50  } },
	  ps:     { class: gutim_ps, preset:init,      in:{ in:sf.out, midi_in_:vctl.out_, reset:sf.reset_trigger, loc_cnt:sf.loc_cnt   },
	                                               preset: "init",
	                                               args:{ fname:"$/m1_458_trans_5.txt" },
						       ui:  { create_fl:true } }
						       
	  xform_igain:  { class: number,   args:{ in:1.0f }, ui: { create_fl:true } },

	  voice_poly: {
	    class: poly,
	    in:   {
	            count:vctl.voice_cnt,
		  }
		  
	    args: { parallel_fl:true }

	    network: {
	      procs: {
	        voc: { class:piano_voice, in:{ _.in:_.vctl.out_ },
		                          out:{ _.done_fl:_.vctl.done_fl_ },
					  args:{ wtb_fname:"~/media/audio/wt6/wt_bank.json",
					         wtb_instr:"piano",
						 rls_coeff: 0.97 } },
		g:     { class: audio_gain,       in:{ in:voc.out, gain:_.xform_igain.out }  },
	        pva:   { class: pv_analysis,      in:{ in:g.out, enable:voc.gate_fl, _.wndSmpN:_.ps.wnd_smp_cnt_ },  args:{ wndSmpN:512, hopSmpN:128, hzFl:false  } },
	        sd:    { class: spec_dist,        in:{ in:pva.out,
		                                       enable:voc.gate_fl,
		                                       _.ceiling:_.ps.ceiling_,
						       _.expo:_.ps.expo_,
						       _.thresh:_.ps.thresh_,
						       _.upr:_.ps.upr_,
						       _.lwr:_.ps.lwr_,
						       _.mix:_.ps.mix_ },  preset:kc, args:{ bypass:false }   },
		
                pvs:   { class: pv_synthesis,     in:{ in:sd.out, enable:voc.gate_fl  } },
	        cmp:   { class: compressor,       in:{ in:pvs.out,
		                                       enable:voc.gate_fl,
		                                       _.igain:_.ps.c_igain_,
						       _.ogain:_.ps.c_ogain_ }, preset:kc, args:{ bypass:false }   },
						       
		ogain: { class: audio_gain,       in:{ in:cmp.out, _.gain:_.ps.dry_gain_ } },
	      }

	    }
	  }

	  wet_poly_mix: { class: audio_mix,   in:{ in_:voice_poly.ogain_.out } args:{ igain_:1.0 }},
	  dry_poly_mix: { class: audio_mix,   in:{ in_:voice_poly.voc_.out}    args:{ igain_:1.0 }},


	  // apply the wet/dry gain balance
	  wd_bal:       { class: balance, args{}},
	  wet_bal_gain: { class: audio_gain, in:{ in:wet_poly_mix.out, gain:wd_bal.out }     },
	  dry_bal_gain: { class: audio_gain, in:{ in:dry_poly_mix.out, gain:wd_bal.inv_out } },

	  mstr_wet_out: { class: audio_gain, in:{ in:wet_bal_gain.out }, args:{ gain:0.5 } }
	  mstr_dry_out: { class: audio_gain, in:{ in:dry_bal_gain.out }, args:{ gain:0.5 } },


	  // merge the wet/dry signals into a single 4 channel signal
	  merge: { class: audio_merge,   in:{ in0:mstr_wet_out.out, in1:mstr_dry_out.out }  },

          aout:  { class: audio_out,     in:{ in:merge.out }, args:{ dev_label:"main" } },

	  
	  
       }
     }
   }


   ex_12_score_follow : {

      //non_real_time_fl:true,
      //dur_limit_secs:10.0,
      //profile_fl:true,

     network: {
       procs: {

	 take_list: { class:gutim_take_menu, ui:{ create_fl:true }, args:{ cfg_fname:"$/gutim_take_menu.cfg" } },

         mf: { class:midi_file, in:{ alt_csv_fname:take_list.fname },  ui: { create_fl:true } },
	 sf: { class:score_follower_2, in:{ in:mf.r_out, reset_trigger:mf.start, b_loc:take_list.beg_loc, e_loc:take_list.end_loc }, args:{ score_fname:"$/score_20240504.csv"}, ui: { create_fl:true } }

	 samp_vt:{ class: vel_table, in:{ in:sf.out }, args:{ vel_tbl_fname:"$/vel_table_perf.json", vel_tbl_label:"ivory" }},
	 pian_vt:{ class: vel_table, in:{ in:sf.out }, args:{ vel_tbl_fname:"$/vel_table_perf.json", vel_tbl_label:"spirio_1" }},

	 mout:   { class: midi_out,  in:{ rin:mf.r_out }, args:{ print_fl:false, dev_label:"iRig MIDI 2", port_label:"iRig MIDI 2 MIDI 1" } ui: { create_fl:true }} 
	 //mout:   { class: midi_out,  in:{ rin:pian_vt.out }, args:{ print_fl:false, dev_label:"Fastlane", port_label:"Fastlane MIDI A" } } 

          vctl:   { class: poly_voice_ctl,             in:{ in:samp_vt.out , reset:mf.start},  args:{ voice_cnt:30 } },


	  ps_ctl: { class: gutim_ps_msg_table, in:{ in:sf.out, sel_id:take_list.take_id }, args:{ fname:"$/gutim_ps_ctl.cfg", sel_id:2 } },

	  ps:     { class: gutim_ps, preset:init,      in:{ in:sf.out,
	                                                     midi_in_:vctl.out_,
							     reset:mf.start,
							     loc_cnt:sf.loc_cnt,
							     pri_prob_fl:ps_ctl.pri_prob_fl,
							     pri_uniform_fl:ps_ctl.pri_uniform_fl,
							     pri_dry_on_play_fl:ps_ctl.pri_dry_on_play_fl,
							     pri_allow_all_fl:ps_ctl.pri_allow_all_fl,							     
							     per_note_fl:ps_ctl.per_note_fl },
	                                               preset: "init",
	                                               args:{ fname:"$/m1_458_trans_5.txt" },
						       ui:  { create_fl:true } }
						       
	  xform_igain:  { class: number,   in:{in:ps_ctl.heat},  ui: { create_fl:true } },

	  voice_poly: {
	    class: poly,
	    in:   { count:vctl.voice_cnt },		  
	    args: { parallel_fl:false, thread_cnt:8, cpu_affinityL:[2,3,4,6,8,9,10,11] },

	    network: {
	      procs: {
	        voc: { class:piano_voice, in:{ _.in:_.vctl.out_ },
		                          out:{ _.done_fl:_.vctl.done_fl_ },
					  args:{ wtb_fname:"~/media/audio/wt6/wt_bank.json",
					         wtb_instr:"piano",
						 rls_coeff: 0.99 } },
						 
		g:     { class: audio_gain,       in:{ in:voc.out, gain:_.xform_igain.out }  },
	        pva:   { class: pv_analysis,      in:{ in:g.out, enable:voc.gate_fl, _.wndSmpN:_.ps.wnd_smp_cnt_ },  args:{ wndSmpN:512, hopSmpN:128, hzFl:false  } },
	        sd:    { class: spec_dist,        in:{ in:pva.out,
		                                       enable:voc.gate_fl,
		                                       _.ceiling:_.ps.ceiling_,
						       _.expo:_.ps.expo_,
						       _.thresh:_.ps.thresh_,
						       _.upr:_.ps.upr_,
						       _.lwr:_.ps.lwr_,
						       _.mix:_.ps.mix_ },  preset:kc, args:{ bypass:false }   },
		
                pvs:   { class: pv_synthesis,     in:{ in:sd.out, enable:voc.gate_fl  } },
	        cmp:   { class: compressor,       in:{ in:pvs.out,
		                                       enable:voc.gate_fl,
		                                       _.igain:_.ps.c_igain_,
						       _.ogain:_.ps.c_ogain_ }, preset:kc, args:{ bypass:false }   },
						       
		ogain: { class: audio_gain,       in:{ in:cmp.out, _.gain:_.ps.dry_gain_ } },
	      }

	    }
	  }


	  //am: { class: audio_merge, in: { in_:voice_poly.voc_.out} }
	  //am: { class: audio_merge, in: { in_:voice_poly.ogain_.out} }
	  //af:  { class: audio_file_out, in: { in:am.out }, args:{  fname:"$/out_fx.wav"} }
	 
	  wet_poly_mix: { class: audio_mix,   in:{ in_:voice_poly.ogain_.out } args:{ igain_:1.0 }},
	  dry_poly_mix: { class: audio_mix,   in:{ in_:voice_poly.voc_.out}    args:{ igain_:1.0 }},


	  // apply the wet/dry gain balance
	  wd_bal:       { class: balance, args{}},
	  wet_bal_gain: { class: audio_gain, in:{ in:wet_poly_mix.out, gain:wd_bal.out }     },
	  dry_bal_gain: { class: audio_gain, in:{ in:dry_poly_mix.out, gain:wd_bal.inv_out } },

	  mstr_wet_out: { class: audio_gain, in:{ in:wet_bal_gain.out }, args:{ gain:0.5 } }
	  mstr_dry_out: { class: audio_gain, in:{ in:dry_bal_gain.out }, args:{ gain:0.5 } },
	   

	  // merge the wet/dry signals into a single 4 channel signal
	  merge: { class: audio_merge,   in:{ in0:mstr_wet_out.out, in1:mstr_dry_out.out }  },

	  // delay the incoming signal to sync it with the piano
	  sync_delay { class: audio_delay, in: { in:merge.out }, args:{ delayMs:400 }}

          aout:  { class: audio_out,     in:{ in:sync_delay.out }, args:{ dev_label:"main" } },

	  //sel_two: { class: audio_split, in:{ in:sync_delay.out } args:{ select[0,0,1,1]} }
	  //aout:  { class: audio_out,     in:{ in:sel_two.out0 }, args:{ dev_label:"main" } },

	  //wd_mix: { class:audio_mix, in:{ in0:mstr_wet_out.out, in1:mstr_dry_out.out } args:{igain_:0.8}}

	  //aout:  { class: audio_out,     in:{ in:wd_mix.out }, args:{ dev_label:"main" } },
	  
	  //af:  { class: audio_file_out, in: { in:wd_mix.out }, args:{  fname:"$/out.wav"} }

	  //aout:  { class: audio_out,     in:{ in:dry_poly_mix.out }, args:{ dev_label:"main" } },


	  
       }
     }
   }


}